<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset=utf-8 />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FracTracker Wells Portal</title>
    <link rel="icon" type="image/png" href="/static/images/ft2021_logo_icon_dark_blue_small.png">

    <!-- Include Project Specific CSS -->

    {% comment %} <link rel = "stylesheet" href = "/static/css/filtering.css"/> {% endcomment %}
    
    <link rel = "stylesheet" href = "/static/css/map.css"/>
    <link rel = "stylesheet" href = "/static/css/table.css"/>

    <!-- Include Leaflet CSS and JavaScript -->
    {% comment %} <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /> {% endcomment %}
    <link rel = "stylesheet" href = "/static/css/leaflet.css"/>

    <link rel="stylesheet" href="https://cdn.rawgit.com/mapbox/supercluster/v4.0.1/demo/cluster.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/supercluster@4.0.1/dist/supercluster.js"></script>
    {% comment %} <script src="https://code.jquery.com/jquery-1.12.4.js"></script> {% endcomment %}
    <!-- for the underscore variable/js function-->
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    {% comment %} <link rel = "stylesheet" href = "/static/css/leaflet-draw.css"/> {% endcomment %}
    {% comment %} <script src="/static/js/leaflet-draw.js"/></script> {% endcomment %}

    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <!-- geojson vt  -->
    <script src="https://unpkg.com/geojson-vt@3.2.0/geojson-vt.js"></script>
    <script src="https://unpkg.com/leaflet-geojson-vt@1.1.0/src/leaflet-geojson-vt.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Archivo&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">


    <style>
        /*
        colors:
         dark blue - 00253B
         fractracker blue - 025687
         light blue - 0287D4
         green - A3CF5F 
         light gray - FDFFFC 

        */


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            font-family: 'Archivo Black', sans-serif;
        }

        /* Header styling */
        header {
            height: 100px;
            width: 100%;
            background-color: white; /*#0287D4;*/
            color: #025687;
            display: grid;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }





        
        .print-btn {
            background-color: red;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
        }
        
        .print-btn:hover {
            background-color: red;
        }
        
        .print-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        

        
        /* Print preview modal */
        .print-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        .print-content {
            position: relative;
            margin: 2% auto;
            width: 80%;
            height: 90%;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        .print-map {
            width: 100%;
            height: 80%;
            border: 1px solid #ddd;
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .print-actions {
            text-align: center;
            margin-top: 15px;
        }
        




        .screenshot-btn {
            font-family: 'Archivo Black'; 
            font-size:18px;
            background-color: #a3cf5f;
            color: #02253a;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 5px;
        }
        
        .screenshot-btn:hover {
            background-color: #a3cf5f;
        }
        
        .screenshot-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .splash-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
          }
        
          .splash-content {
            max-width: 1000px;
            width: 80%;
            height: 80%;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* center both horizontally and vertically */
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            font-family: 'Archivo Black', sans-serif;
            color: #02253a;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* keeps top content and bottom tabs spaced out */
          }
          
          .enter-button {
            display:none;
            height: 50px;
            width: 100px;
            background-color: #a3cf5f;
            color: #02253a;
            font-weight: bold;
            font-size:16px;
            border:none;
            border-radius:6px;
            cursor: pointer;
          }
          .enter-button.enabled {
            display:block;
            opacity: 1;
            pointer-events: auto;
          }
          .close-button {
            display:none;
            position: absolute;
            top: 15px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
          }
        
          .close-button:hover {
            color: #000;
          }
        
          .close-button.enabled {
            display: block;
            pointer-events: auto;
          }

          .checkbox-agree:hover{
            cursor: pointer;
          }

          .tab-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            border-top: 1px solid #ccc;
            padding-top: 15px;
          }
        
          .tab-buttons button {
            flex: 1;
            margin: 0 5px;
            background-color: #02253a;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Archivo Black', sans-serif;
          }
        
          .tab-buttons button:hover {
            background-color: #035;
          }
        
          .tab-content {
            min-height: 150px;
          }


        /* Main content styling */
        .main-content {
            display: flex;
            height: calc(100vh - 100px); /* Subtract header height */
        }
        /* Right side */
        .right {
          /* flex-grow: 1; */
          /* height: 100%; */
          width: 100%;
          overflow-x: auto;

        }
        #container {
          height: 100%;
          display: flex;
          flex-direction: column;
        }
        #dividerContainer {
            cursor: ns-resize;
            background-color: #00253B;
            height: 40px;
            width: 100%;
            user-select: none;
            border-top-right-radius:12px;
            border-top-left-radius:12px;
          }
        #loading-popupid {
            display: none
        }


                
        /* Left side panel*/
        .left { /* Style the sidebar */
                width: 275px;
                min-width: 190px;
                {% comment %} height: 81vh; {% endcomment %}
                float: left; /* Float sidebar to the left */
                font-family: 'Archivo Black', sans-serif;
                color: #00253B;
                background-color: #02253a;
                overflow-y: auto;
                overflow-x: hidden;
                padding: 10px;
                border: solid;
                border-width: 6px;
                border-color: #00253a;
                border-radius:20px;
                margin:6px;
                position:relative;
        }




        /* Style the content inside the sidebar */
        #sidebar-content {
            {% comment %} margin-top: -20px; {% endcomment %}
            {% comment %} padding: 10px; {% endcomment %}
        }

        .filter {
            {% comment %} margin-bottom: 10px; {% endcomment %}
            {% comment %} padding: 8px; {% endcomment %}
            font-family: 'Archivo Black', sans-serif;
            margin-left: -10px;
            margin-right: -10px;
            background-color:#00253a;
        }
        .filter h4:hover {
            background-color: #001520;
        }
        .filter h4 {
            cursor: pointer;
            {% comment %} margin-bottom: 5px; {% endcomment %}
            color: white;
            position: relative;
            padding: 12px;

        }

        .filter h4::after {
            content: var(--after-content, "");
            float: right;
            position: absolute;
            left: 0px;
            color:#ffc857;

        }

        .filter.show h4::after {
            content: var(--after-content, "_");
            position: relative;
            top: -3px;
            left: 0px;
            color:#ffc857;

        }

        .filter.hide h4::after {
            content: var(--after-content, "‚åÑ");
            position: relative;
            top: -5px;
            left: 0px;
            color:#ffc857;

        }

        .filter.show {
            {% comment %} border: solid {% endcomment %}
        }

        .filter.hide {
            border: none
        }
        .filter-content {
            display: none;
            padding: 10px;
            color: white;
            text-align: center;
        }

        .fh4 {
            cursor: default;
            font-family:Archivo;
            color:white;
            background-color:#02253a;
            padding-left:12px;
            padding-bottom:0px;
        }
        .fh4.show {
            {% comment %} background-color: #00253a; {% endcomment %}
            background-color: #001520;

        }
        .fh4.stay:hover {
            cursor: default;
            background-color: #00253a;

        }
        .fh4.hide {
            background-color: #00253a;
        }
        .filter-content.show {
            display: block;
            font-size: 12px;
            {% comment %} background-color: #025687; {% endcomment %}
            background-color: #001520;
            overflow-y: auto;
            max-height: 800px;

        }


        /* Style smaller checkboxes */
        .filter input[type="checkbox"] {
            transform: scale(0.75);
            margin-right: 5px;
        }

        /* Button style */
        .filter-content button {
            margin-top:5px;
            {% comment %} width: 49%; {% endcomment %}
            font-size: 12px;
            cursor: pointer;
        }

        .selectionContainer {
            {% comment %} background-color: rgb(216, 216, 216); {% endcomment %}
            background-color:#00253a;
            {% comment %} color:rgb(104, 104, 104); {% endcomment %}
            color:white;
            font-family:arial;
            font-weight:normal;
            max-height: 33vh;
            padding: 5px;
            border-radius: 5px;
            margin-bottom:2px;
            overflow-y: auto;
            display: grid;
            grid-template-rows: max-content;
        }
        .button-container {
            display: none;
            padding-top: 8px;
            padding-bottom: 8px;
            justify-content: left;
            color: red;
            position: relative;
            background-color: white;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px; 
            overflow: auto;
            max-height: 24vh;
            min-height: auto;
        
        }
        .filterbutton {
            width: 100%;
            text-rendering: auto;
            color: black;
            letter-spacing: normal;
            word-spacing: normal;
            line-height: normal;
            text-transform: none; 
            {% comment %} text-indent: 10px; {% endcomment %}
            text-shadow: none; 
            display: grid;
            text-align: center;
            align-items: flex-start; 
            cursor: default;
            box-sizing: border-box; 
            background-color: white;
            margin: 0em;
            padding-block: 2px; 
            padding-inline: 2px; 
            border-width: 2px; 
            border-style: none;
            border-color: buttonborder; 
            border-image: initial; 
        }
        .filterbutton:hover {
            background-color: rgb(179, 179, 179);
            cursor: pointer;
        }
        .highlightbutton {
            width: 100%;
            text-rendering: auto;
            color: black;
            letter-spacing: normal;
            word-spacing: normal;
            line-height: normal;
            text-transform: none; 
            {% comment %} text-indent: 30px; {% endcomment %}
            text-shadow: none; 
            display: grid;
            text-align: center;
            align-items: flex-start; 
            cursor: default;
            box-sizing: border-box; 
            background-color: #b2ddf4;
            margin: 0em;
            padding-block: 2px; 
            padding-inline: 2px; 
            border-width: 2px; 
            border-style: none;
            border-color: buttonborder; 
            border-image: initial; 
        }
        .highlightbutton:hover {
            background-color: rgb(255, 0, 0);
            color: white;
        }
        .dropdownbutton {
            background-color: #a3cf5f;
            color: #00253a;
            {% comment %} border-radius: 5px; {% endcomment %}
            width: 100%;
            {% comment %} border: none; {% endcomment %}
            border-color: #a3cf5f;
            border-radius: 8px;
            padding: 2px;
        }
        .dropdownbutton.notyet:hover {
            cursor: not-allowed;
        }
        .dropdownapplybutton {
            background-color: #a3cf5f;
            color: #00253a;
            {% comment %} border-radius: 5px; {% endcomment %}
            width: 100%;
            {% comment %} border-color: #00253B; {% endcomment %}
            {% comment %} padding: 2px; {% endcomment %}
            border-color: #a3cf5f;
            border-radius: 8px;
        }
        .dropdownapplybutton:hover {
            cursor: pointer;
        }
        .selbutton {
            background-color: #00253a;
            border: 1px solid white;
            color:white;
            border-radius: 3px;
            padding: 5px;
            margin: 2px;
            font-family:arial;
            font-weight:normal;
        }
        .selbutton:hover {
            {% comment %} background-color: red; {% endcomment %}
            {% comment %} color: white; {% endcomment %}
            cursor: pointer;
        }
        .divbtns {
            background-color:white;
            color:#00253B;
            border:none;
            padding: 4px;
            border-radius: 6px;
        }
        .divbtns:hover {
            cursor: pointer;
        }

        .pagebtn {
            background-color:white;
            color:#00253B;
            border:none;
            padding: 4px;
            margin-left:2px;
            margin-right: 2px;
            border-radius: 6px;
        }
        .pagebtn:hover {
            cursor: pointer;
            background-color: #d4dadc;
        }

        .alert {
            padding: 20px;
            background-color: white;

            {% comment %} background-color: #f44336; {% endcomment %}
            color: black;
        }
        .alert.hide {
            display: none,
        }
        .alert.show {
            padding: 20px;
            background-color: #f44336;
            color: white;
        }
        .closebtn {
            margin-left: 15px;
            color: white;
            font-weight: bold;
            float: right;
            font-size: 22px;
            line-height: 20px;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .closebtn:hover {
            color: black;
        }

        .arrow {
            border: solid black;
            border-width: 0 3px 3px 0;
            display: inline-block;
            padding: 3px;
        }
        .up {
            transform: rotate(-135deg);
            -webkit-transform: rotate(-135deg);
        }
        
        .down {
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
        }
        #dlbutton {
            display: none;
            width: 100%;
        } 
        .dropdownbutton::after {
            content: '‚åÑ'; /* Down arrow Unicode */
            font-size: 18px; /* Space between text and the arrow */
            font-weight:bold;
            position:relative;
            top:-3px;
            left: 30px;
        }
        .refine {
            display:block
        }
        .refine.hidden {
            display:none
        }

        .image-container {
            width: 300px;
            height: 200px;
            border: 2px solid #000;
            text-align: center;
            margin: 20px;
        }
        .tabbtn {
        color:white;
        background-color:#025687;
        margin-top:-14px;
        border:none;
        font-weight: bold;
        }
        .tabbtn:hover {
        background-color:#006199;
        cursor: pointer;
        }
        .tabbtn.sel {
        background-color: #00253a;
        cursor:arrow;
        }
        .tabbtn.sel:hover {
        cursor: default;
        }
        .tabpanel.show {
        display:block;
        }
        .tabpanel.hide {
        display:none
        }
        /* HTML: <div class="loader"></div> */
        .loader {
        width: 50px;
        aspect-ratio: 1;
        display: grid;
        border-radius: 50%;
        background:
            linear-gradient(0deg ,rgb(0 0 0/50%) 30%,#0000 0 70%,rgb(0 0 0/100%) 0) 50%/8% 100%,
            linear-gradient(90deg,rgb(0 0 0/25%) 30%,#0000 0 70%,rgb(0 0 0/75% ) 0) 50%/100% 8%;
        background-repeat: no-repeat;
        animation: l23 1s infinite steps(12);
        }
        .loader::before,
        .loader::after {
        content: "";
        grid-area: 1/1;
        border-radius: 50%;
        background: inherit;
        opacity: 0.915;
        transform: rotate(30deg);
        }
        .loader::after {
        opacity: 0.83;
        transform: rotate(60deg);
        }
        @keyframes l23 {
        100% {transform: rotate(1turn)}
        }
        .loadingobjects {
            display:grid;
            justify-content:center
        }
        .ovdrop{
            background-color:white;
            color:black
        }
        .ovdrop:hover {
            color:red
        }

        .dim {
            color:lightgray
        }
        .dim:hover {
            cursor: not-allowed;
        }
        /* Apply progress cursor when loading */
        .loadinglayer {
          cursor: not-allowed;
        }
        {% comment %} .leaflet-control-layers leaflet-control-layers-expanded leaflet-control" {% endcomment %}
        .splash-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0,0,0,0.6);
          }
        
          .splash-content {
            max-width: 1000px;
            width: 80vw;
            height: 80vh;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* center both horizontally and vertically */
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            font-family: 'Archivo Black', sans-serif;
            color: #02253a;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* keeps top content and bottom tabs spaced out */
          }
        
          .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
          }
        
          .close-button:hover {
            color: #000;
          }
        
          .tab-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            border-top: 1px solid #ccc;
            padding-top: 15px;
          }
        
          .tab-buttons button {
            flex: 1;
            margin: 0 5px;
            background-color: #02253a;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Archivo Black', sans-serif;
          }
        
          .tab-buttons button:hover {
            background-color: #035;
          }
        
          .tab-content {
            min-height: 150px;
          }

          /* Modal overlay */
          .modal {
              display: none; /* Hidden by default */
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background-color: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              justify-content: center;
              align-items: center;
          }
          .modal.show {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
          /* Modal content */
          .modal-dialog {
              background-color: white;
              padding: 20px;
              border-radius: 5px;
              max-width: 514px;
              width: 100%;
          }
          
          /* Modal header */
          .modal-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
          }
          
          /* Modal footer */
          .modal-footer {
              display: flex;
              justify-content: flex-end;
              gap: 10px;
          }
          
          /* Close button */
          .close {
              font-size: 24px;
              background: none;
              border: none;
              cursor: pointer;
          }
          
          /* Show the modal */

          /* Spinner */
          .spinner-border {
              display: inline-block;
              width: 1rem;
              height: 1rem;
              border: 0.15em solid transparent;
              border-top: 0.15em solid currentColor;
              border-radius: 50%;
              animation: spin 0.75s linear infinite;
          }
          
          @keyframes spin {
              to { transform: rotate(360deg); }
          }
          

    </style>
</head>
<body>

    {% comment %} <header>
        <div>
            <h1 style="color:#02253a;text-decoration: underline;text-decoration-color:#A3CF5F">National Oil & Gas Well Inventory</h1>
        </div>
        <div style="justify-self:center">
            <h4 style="color:#025687;font-weight:normal">Updated August 1, 2025<h4>
        </div>
    </header> {% endcomment %}

    <header style="display: flex; justify-content: space-between; margin-left: -10px; padding: 10px 20px;">
        <div style="display: flex; align-items: center;">
            <a href="https://www.fractracker.org/" target="_blank" style="text-decoration: none;">
                <img class="header-image" style="font-family:Archivo Black; margin-top:10px; height:90px; width:90px; position: relative; z-index: 5100;" src="/static/images/ft2021_logo_icon dark_blue.png">
            </a>
            <h1 style="font-family:Archivo Black; margin-top:4px; margin-left: 20px; color:#02253a; line-height:1; font-size:45px;">
                Oil & Gas Wells<br>Data Portal
            </h1>
        </div>
        {% comment %} <div>
            <h4 style="color:#025687;font-weight:normal">Updated August 1, 2025<h4>
        </div> {% endcomment %}
    
        <div style="display: flex; gap: 10px;margin: 16px 10px">
            <button onclick="openSplash()"
                    style="font-family: 'Archivo Black'; background-color: #02253a; color: white; border: none; padding: 10px 22px; border-radius: 5px; cursor: pointer;">
                About&nbsp;&nbsp;‚ùØ
            </button>
            <a href="https://www.fractracker.org/data/" target="_blank" style="text-decoration: none;">
                <button style="font-family: 'Archivo Black'; background-color: #ffc857; color: #02253a; border: none; padding: 16px 22px; border-radius: 5px; cursor: pointer;">
                  More Data&nbsp;&nbsp;‚ùØ
                </button>
            </a>
        </div>
    </header>

    <div class="main-content">
        
        <div class="left" >
            <div id="tabbtns" style="display:grid;grid-template-columns: 50% 50%;height: 5vh">
                <button class="tabbtn sel" id="filterbtn" style="border-top-left-radius:20px;margin-left:-12px;font-family:arial">Filter</button>
                <button class="tabbtn" id="resultsbtn" style="border-top-right-radius:20px;margin-right:-12px;font-family:arial">Results</button>
            </div>
            <div class="tabpanel " id="filterpanel">
                <!-- filtering tools here -->
                <div class="filter">  {% comment %} toggle-states show"> {% endcomment %} 
                    <h4 class="fh4 stay" style="margin-top:25px;margin-bottom:-10px" id="statesh4" onclick="toggleFilter('states')">State</h4>
                    <div class="filter-content states-content show" id="filterState" style="background-color:#00253a">
                        <label for="stateinputbox" style="display:block;padding-bottom: 5px;font-weight:normal;font-family:Arial">Choose up to 3:</label>
                        <div class="selectionContainer" style="display:flex;justify-content:center;color:#ffc857;cursor:default" id="statePicks">**REQUIRED**</div>
                        <button class="dropdownbutton" id="statebutton" style="text-align:center" onclick="openlist('state')">&nbsp;&nbsp;&nbsp;&nbsp;Available States</button>
                        <div class="button-container" id="state-container" style="font-family:arial;font-weight:normal"></div>
                    </div>
                </div>
                <div class="filter toggle-counties hide">
                    <h4 class="fh4" id="countiesh4" onclick="toggleFilter('counties')">County</h4>
                    <div class="filter-content counties-content hide" id="ctyFilterContainer">
                        {% comment %} <label for="countyPicks">County:</label> {% endcomment %}
                        <div class="selectionContainer" id="countyPicks" style="max-height:14vh">You can limit your results to those within a specific county by clicking the corresponding button below.</div>
                        <button class="dropdownbutton notyet" id="countybutton" onclick="openlist('county')">Counties by State</button>
                        <div class="button-container" id="county-container"></div>
                    </div>
                </div>
                <div class="filter toggle-wellstatus hide">
                    <h4 class="fh4" id="wellstatush4" onclick="toggleFilter('wellstatus')">State Well Status</h4>
                    <div class="filter-content wellstatus-content" id="statusContainer">
                        <div class="selectionContainer" id="statusPicks" style="max-height:14vh">Status varies from state to state, take a look at the reference below.</div>
                        <button class="dropdownbutton notyet" id="statusbutton" onclick="openlist('wellstatus')">Well Status</button>
                        <div class="button-container" id="status-container"></div>
                    </div>
                </div>
                <div class="filter toggle-welltype hide">
                    <h4 class="fh4" id="welltypeh4" onclick="toggleFilter('welltype')">State Well Type</h4>
                    <div class="filter-content welltype-content" id="typeContainer">
                        <div class="selectionContainer" id="typePicks" style="max-height:14vh">Type varies from state to state, take a look at the reference below.</div>
                        <button class="dropdownbutton notyet" id="typebutton" onclick="openlist('welltype')">Types Available</button>
                        <div class="button-container" id="type-container"></div>
                    </div>
                </div>
                {% comment %} <div class="filter-content">
                    <label for="well_name">Well Name:</label>
                    <input type="text" id="well_name" name="well_name" placeholder="Enter Well Name...">
                </div> {% endcomment %}

                <div class="filter toggle-ftacat hide">
                    <h4 class="fh4" id="ftacath4" onclick="toggleFilter('ftacat')">Well Category</h4>
                    <div class="filter-content ftacat-content" id="ftacatContainer">
                        <div class="selectionContainer" id="ftacatPicks" style="max-height:14vh">Our attempt to normalize the varying classifications across the country. </div>
                        <button class="dropdownbutton notyet" id="ftacatbutton" onclick="openlist('welltype')">General Classification</button>
                        <div class="button-container" id="ftacat-container"></div>
                    </div>
                </div>
                <div >
                    <button style="padding:20px;margin-top:10px" class="dropdownapplybutton" onclick="applyCategoryFilter()"><strong>Apply Filter</strong></button>
                </div>
            </div>
            <div class="tabpanel hide" id="loadingpanel">
                <div class="loadingobjects">
                    <div id="loadingtext" style="font-family:arial;font-weight:normal;margin-top:60px;margin-bottom:20px;color:white">
                        Retrieving your records...
                    </div>
                    <div id="spinnerid" class="loader" style="margin:auto"></div>
                </div>
            </div>
            <div class="tabpanel hide" id="resultspanel">
                <div id="postapply"  style="margin-top:30px">

                    <div class="refine" id="refineblock">

                        <div id="search" style="margin-top:25px">
                            {% comment %} <label>Refine your search</label> {% endcomment %}
                            <select id="sort-field2" style="cursor:pointer;text-align:center;padding: 5px;margin-top:10px;margin-bottom:14px" class="dropdownbutton">
                                <option value="" style="color:#8a8a8a" selected>Refine your search</option> <!-- Placeholder option -->
                                <option value="api_num" class="ovdrop">API Number</option>
                                <option value="county" class="ovdrop">County</option>
                                <option value="well_name" class="ovdrop">Well Name</option>
                                <option value="operator" class="ovdrop">Operator</option>
                                <option value="spud_date" class="ovdrop">Spud Date</option>
                                <option value="plug_date" class="ovdrop">Plug Date</option>
                                <option value="well_type" class="ovdrop">Well Type</option>
                                <option value="well_status" class="ovdrop">Well Status</option>
                                <option value="well_configuratin" class="ovdrop">Well Configuration</option>
                                <option value="ft_category" class="ovdrop">FracTracker Category</option>
                            </select>
                            <div style="display:grid;grid-template-columns:84% 16%;width:100%">
                                <div style="text-align:center;border:none;height:25px;background-color:#0287D4;border-radius:4px"><input id="srch-input" style="text-indent:5px;border:none;border-radius:4px;height:25px;width:100%"></input></div>
                                {% comment %} <input style="width:120px;text-align: right;" type="number" id="sort-input" placeholder="Jump to page #" min="1"> {% endcomment %}
                                <div style="justify-self:right;text-align:center;border:none;height:25px;background-color:white;border-radius:7px"><button id="sortbtn2" class="divbtns" onclick="refinefilter()">Go</button></div>
                            </div>    
                        </div>
                        <div id="drawradius" style="display:grid;grid-auto-flow: column;margin-top:10px">
                            <div id="drawtext" style="margin-top:4px;color:white;font-family:arial;font-weight:normal;font-size:12px"><h4>Select wells within a circle:</h4></div>
                            <div id="controls" style="width:fit-content;justify-self:right">
                                <div id="draw-controls"></div> <!-- Draw control outside the map -->
                            </div>
                        </div>
                        <div>
                            <button class="dropdownapplybutton" style="margin-top:16px;padding:7px" onclick="updateTable(filteredData.features)">Clear Selection</button>
                        </div>
                        {% comment %} <button onclick="downloadTableData(filteredData)">Download CSV</button> {% endcomment %}
                        <div class="controls" style="position: absolute; bottom: 87px; left: 10px; right: 10px;">
                            {% comment %} <button class="print-btn" onclick="showPrintPreview()">üìã Create Map Screenshot</button> {% endcomment %}
                            <button class="divbtns" id="pbutton" style="display:none;width:100%;font-family: 'Archivo Black'; font-size:18px;height: 60px; display: block; background-color: #ffc857;" onclick="showPrintPreview()"><i class="fa-solid fa-print"></i> Print Map</button>
                        </div>
                        
                        {% comment %} <div class="dlbtn" style="position: absolute; bottom: 10px; left: 10px; right: 10px;">
                            <button class="divbtns" id="dlbutton" style="font-family: 'Archivo Black'; font-size:18px;height: 60px; display: block; background-color: #ffc857;" onclick="downloadTableData(filteredData)">Download <span style="font-size: 20px; display: inline-block; transform: rotate(270deg); margin-left: 8px;">&#8676;</span></button>
                        </div> {% endcomment %}
                        <div class="dlbtn" style="position: absolute; bottom: 10px; left: 10px; right: 10px;">
                            <button type="button" class="btn btn-primary divbtns" data-bs-toggle="modal" data-bs-target="#downloadModal" style="width:100%; font-family: 'Archivo Black'; font-size:18px;height: 60px; display: block; background-color: #ffc857;" >Download <span style="font-size: 20px; display: inline-block; transform: rotate(270deg); margin-left: 8px;">&#8676;</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="right" id="container">
            <!-- Top content of the right side -->
            <div id="map">
                {% comment %} <img class="header-image" style="height: 60px;position: absolute; right: 10px;z-index: 5100;" src="/static/images/fta.png"> {% endcomment %}

                <div class="legend" id="legend" >
                    <div class="legend-header" style="display:grid;grid-auto-flow: column;" id="legend-toggle">
                        <div style="justify-self:right">
                            <span>Legend</span>
                        </div>
                        <div  style="justify-self:right">
                            <span id="legend_arrow">x</span>
                        </div>
                    </div>
                    <div class="legend-content">
                        <p style="margin-bottom:5px"><strong>Well Locations</strong></p>
                        <div class="legenditem " id="legenditemid11"><label class="category1 dim" id="legenditemid21"><input type="checkbox" id="category1" class="dim" unchecked><img src="../static/images/cat1.png" style='height:17px;width:19px;margin-right:2px;margin-left:-6px'>Injection / Storage / Service</label></div>
                        <div class="legenditem " id="legenditemid12"><label class="category1 dim" id="legenditemid22"><input type="checkbox" id="category2" class="dim" unchecked><img src="../static/images/cat2.png" style='height:17px;width:19px;margin-right:2px;margin-left:-6px'> Not Drilled</label></div>
                        <div class="legenditem " id="legenditemid13"><label class="category1 dim" id="legenditemid23"><input type="checkbox" id="category3" class="dim" unchecked><img src="../static/images/cat3.png" style='height:17px;width:19px;margin-right:2px;margin-left:-6px'> Orphaned / Abandoned / Unverified Plug</label></div>
                        <div class="legenditem " id="legenditemid14"><label class="category1 dim" id="legenditemid24"><input type="checkbox" id="category4" class="dim" unchecked><img src="../static/images/cat4.png" style='height:17px;width:19px;margin-right:2px;margin-left:-6px'> Other / Unknown</label></div>
                        <div class="legenditem " id="legenditemid15"><label class="category1 dim" id="legenditemid25"><input type="checkbox" id="category5" class="dim" unchecked><img src="../static/images/cat5.png" style='height:17px;width:19px;margin-right:2px;margin-left:-6px'> Plugged</label></div>
                        <div class="legenditem " id="legenditemid16"><label class="category1 dim" id="legenditemid26"><input type="checkbox" id="category6" class="dim"  unchecked><img src="../static/images/cat6.png" style='height:17px;width:19px;margin-right:2px;margin-left:-6px'> Production Well</label></div>
                        <p style="margin-bottom:5px"><strong>County Layers</strong></p>
                        <div class="legenditem " id="legenditemid17"><label class="category1 dim" id="legenditemid27"><input type="checkbox" id="countylayer" class="dim"  unchecked> County Borders</label></div>
                        <div class="legenditem " id="legenditemid18"><label class="category1 dim" id="legenditemid28"><input type="checkbox" id="countycount" class="dim"  unchecked> County Counts</label></div>
                        <div class="legenditem " id="legenditemid19"><label class="category1 dim" id="legenditemid29"><input type="checkbox" id="countychoropleth" class="dim"  unchecked> County Choropleth</label></div>
                    </div>
                </div>
            </div>
            <div class="divider" id="dividerContainer" style="z-index: 1000;margin-top:-12px">
                <div>
                    <div style="padding:9px;display:grid;grid-auto-flow:column">
                        <div>
                            <div>
                                <input style="border:none;width:148px;text-align:center;height:25px;background-color:white;border-radius:7px" type="number" id="page-input" placeholder="Jump to page #" min="1">
                                <button class="divbtns" onclick="goToPage()">Go</button>
                            </div>
                            {% comment %} <div class="pagenav-container" style="justify-self:center">
                                <span id="pagination" style="justify-self: center"></span>
                            </div> {% endcomment %}
                        </div>
                        <div style="color:white;margin-top:2px;justify-self:center">
                            <span id="records"></span>
                        </div>
                        <div style="justify-self:right">
                            <!-- Dropdown with a placeholder-like option for "Sort by" -->
                            <select id="sort-field" style="text-align:center;border:none;height:25px;background-color:white;border-radius:7px">
                                <option value="" style="color:#8a8a8a" selected>Choose a field</option> <!-- Placeholder option -->
                                <option value="api_num">API Number</option>
                                <option value="county">County</option>
                                <option value="well_name">Well Name</option>
                                <option value="operator">Operator</option>
                                <option value="spud_date">Spud Date</option>
                                <option value="plug_date">Plug Date</option>
                                <option value="well_type">Well Type</option>
                                <option value="well_status">Well Status</option>
                                <option value="well_configuratin">Well Configuration</option>
                                <option value="ft_category">FracTracker Category</option>
                            </select>
                            {% comment %} <input style="width:120px;text-align: right;" type="number" id="sort-input" placeholder="Jump to page #" min="1"> {% endcomment %}
                            <button id="sortbtn" class="divbtns" onclick="sortTable()">Sort</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom" id="bottomContainer">
            <!-- Bottom content of the right side -->
                <div>
                    <div id="pagination" style="display:flex;justify-content:center">
                    </div>
                </div>
                <div class="tablecontainer">

                    <!-- Grid container for the table -->
                    <table id="maintable">
                        {% comment %} <thead>
                            <tr>
                                <td id="pagination" colspan="100%">
                                <!-- Pagination buttons will be added here -->
                                </td>
                                <td>
                                    <button> btn </button>
                                </td>
                            </tr>
                        </thead> {% endcomment %}
                        <thead id="maintableheader" class="sticky-header-container">
                            <tr>
                                {% comment %} <th>TMPID</th> {% endcomment %}
                                <th>API Number</th>
                                <th>Other ID</th>
                                <th>Latitude</th>
                                <th>Longitude</th>
                                <th>State</th>
                                <th>County</th>
                                <th>Municipality</th>
                                <th>Well Name</th>
                                <th>Operator</th>
                                <th>Spud Date</th>
                                <th>Plug Date</th>
                                <th>Well Type</th>
                                <th>Well Status</th>
                                <th>Well Configuration</th>
                                <th>FracTracker Category</th>
                                {% comment %} <th>UID</th> {% endcomment %}
                            </tr>
                        </thead>
                        <tbody id="maintablebody">
                            {% comment %} <tr><td></td></tr> {% endcomment %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
<!-- Download Modal -->
<div id="downloadModal" class="modal fade" tabindex="-1" aria-labelledby="downloadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <p class="modal-title" id="downloadModalLabel" style="color:#02253a;font-family:archivo black">Your data is ready!</p
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body" style="margin-top:18px">
          <p class="mb-3" style="margin-bottom:4px;font-family:arial;font-weight:normal;color:#02253a">Please provide some basic information to help us better serve you:</p>
          <form id="downloadForm">
            {% csrf_token %}
            <div class="mb-3">
              <label for="userName" class="form-label" style="color:#02253a;font-family:archivo black">Name <span style="color: red;">*</span></label>
              <input type="text" class="form-control" id="userName" name="name" style="margin-left:34px;width:160px" required placeholder="Enter your name">
            </div>
            <div class="mb-3">
              <label for="userEmail" class="form-label" style="color:#02253a;font-family:archivo black">Email <span style="color: red;">*</span></label>
              <input type="email" class="form-control" id="userEmail" name="email" style="margin-left:36px;width:160px" required placeholder="Enter your email">
            </div>
            <div class="mb-3">
                <label for="userAffiliation" class="form-label" style="color:#02253a;font-family:archivo black">Affiliation <span style="color: red;">*</span></label>
                <select class="form-control" id="userAffiliation" name="affiliation" style="margin-left:0px;width:160px" required>
                    <option value=""></option>
                    <option value="Community Member">Community Member</option>
                    <option value="Student">Student</option>
                    <option value="Industry">Industry</option>
                    <option value="Nonprofit">Nonprofit</option>
                    <option value="Government">Government</option>
                    <option value="Other">Other</option>
                </select>              
            </div>
            <div class="mb-3">
                <label for="userState" class="form-label" style="color:#02253a;font-family:archivo black">
                    State 
                </label>
                <select class="form-control" id="userState" name="state"  style="margin-left:52px;width:160px" required>
                    <option value=""></option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                    <option value="DC">District of Columbia</option>
                    <option value="Other">International</option>
                </select>
            </div>
            
            <div style="margin-top:6px">
                <label style="font-family:arial;font-weight:normal;font-size:smaller;color:#02253a"><input type="checkbox" class ="checkbox-feedback" id="fCheckbox"> Open our feedback form in a new tab to provide additional insight</label>
            </div>
          </form>
          <div id="errorMessage" class="alert alert-danger d-none"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="print-btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="screenshot-btn btn-primary" id="downloadBtn">
            Download CSV
          </button>
        </div>
      </div>
    </div>
  </div>
    <!-- Print Preview Modal -->
    <div id="printModal" class="print-modal">
        <div class="print-content">
            <button class="close-btn" onclick="closePrintPreview()">&times;</button>
            <div class="print-header">
                <h2>Map Preview</h2>
                <p>Date: <span id="printDate"></span></p>
            </div>
            <div id="printMap" class="print-map">
            </div>
            <div class="print-actions">
                {% comment %} <div class="controls" style="position: absolute; bottom: 87px; left: 10px; right: 10px;"> {% endcomment %}
                    {% comment %} <button class="print-btn" onclick="showPrintPreview()">üìã Create Map Screenshot</button> {% endcomment %}
                <button class="screenshot-btn" onclick="captureMapScreenshot()"><i class="fa-solid fa-print"></i> Print Map</button>
                {% comment %} <button class="screenshot-btn" onclick="captureMapScreenshot()">üì∏ Download Screenshot</button> {% endcomment %}
                <button class="print-btn" onclick="closePrintPreview()">Cancel</button>
            </div>
        </div>
    </div>
    <!-- Splash Modal -->
    <div id="splashScreen" class="splash-modal">
        <div class="splash-content">
            <span class="close-button" onclick="closeSplash()">&times;</span>
        
            <!-- Main Content Area (changes when tabs are clicked) -->
            <div id="tabContent" class="tab-content" style="overflow-y:auto">
                <h2>Welcome</h2>
                <p>This is the default content shown in the modal.</p>
            </div>
        
            <!-- Tab Buttons -->
            <div class="tab-buttons">
                <button disabled onclick="showTab('tab1')" class="btn" id="btn1" disabled>Terms of Service</button>
                {% comment %} <button onclick="showTab('tab2')">Quick Guide</button> {% endcomment %}
                <button disabled onclick="showTab('tab3')" class="btn" id="btn2" disabled>Data Details</button>
            </div>
        </div>
    </div>


    <!-- Include Project Specific JavaScript -->
    <script src = "/static/js/wells.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>

        let printMapInstance;


        // Screenshot preview function
        function showPrintPreview() {
            const pmodal = document.getElementById('printModal');
            const printDate = document.getElementById('printDate');
            
            // Set current date
            printDate.textContent = new Date().toLocaleDateString();
            
            // Show modal
            pmodal.style.display = 'block';
            
            // Create print map instance with better layer handling
            setTimeout(() => {
                if (printMapInstance) {
                    printMapInstance.remove();
                }
                
                printMapInstance = L.map('printMap').setView(map.getCenter(), map.getZoom());
                
                // Find the current tile layer from the main map
                let originalTileLayer;

                map.eachLayer(layer => {
                    if (layer instanceof L.TileLayer && !(layer instanceof L.ImageOverlay)) {
                        originalTileLayer = layer;
                    }
                });

                let tileLayer;
                if (originalTileLayer) {
                    tileLayer = L.tileLayer(originalTileLayer._url, {
                        ...originalTileLayer.options
                    }).addTo(printMapInstance);
                } else {
                    // Fallback to OpenStreetMap if no tile layer found
                    tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors',
                        maxZoom: 19
                    }).addTo(printMapInstance);
                }
                
                // Wait for base tiles to load
                let tilesLoaded = 0;
                let tilesToLoad = 0;
                
                tileLayer.on('tileloadstart', function() {
                    tilesToLoad++;
                });
                
                tileLayer.on('tileload', function() {
                    tilesLoaded++;
                });
                
                tileLayer.on('tileerror', function() {
                    tilesLoaded++;
                });
                
                // Copy all layers from original map with full styling
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker) {
                        // Copy marker with all options including custom icons
                        const newMarker = L.marker(layer.getLatLng(), {
                            icon: layer.options.icon,
                            opacity: layer.options.opacity,
                            ...layer.options
                        }).addTo(printMapInstance);
                        if (layer.getPopup()) {
                            newMarker.bindPopup(layer.getPopup().getContent());
                        }
                    } else if (layer instanceof L.Polyline && !(layer instanceof L.Polygon)) {
                        // Handle polylines with full styling
                        const newPolyline = L.polyline(layer.getLatLngs(), {
                            color: layer.options.color,
                            weight: layer.options.weight,
                            opacity: layer.options.opacity,
                            fillColor: layer.options.fillColor,
                            fillOpacity: layer.options.fillOpacity,
                            dashArray: layer.options.dashArray,
                            lineCap: layer.options.lineCap,
                            lineJoin: layer.options.lineJoin,
                            ...layer.options
                        }).addTo(printMapInstance);
                        if (layer.getPopup()) {
                            newPolyline.bindPopup(layer.getPopup().getContent());
                        }
                    } else if (layer instanceof L.Polygon) {
                        // Handle polygons with full styling
                        const newPolygon = L.polygon(layer.getLatLngs(), {
                            color: layer.options.color,
                            weight: layer.options.weight,
                            opacity: layer.options.opacity,
                            fillColor: layer.options.fillColor,
                            fillOpacity: layer.options.fillOpacity,
                            dashArray: layer.options.dashArray,
                            lineCap: layer.options.lineCap,
                            lineJoin: layer.options.lineJoin,
                            ...layer.options
                        }).addTo(printMapInstance);
                        if (layer.getPopup()) {
                            newPolygon.bindPopup(layer.getPopup().getContent());
                        }
                    } else if (layer instanceof L.Circle) {
                        // Handle circles with full styling
                        const newCircle = L.circle(layer.getLatLng(), {
                            radius: layer.getRadius(),
                            color: layer.options.color,
                            weight: layer.options.weight,
                            opacity: layer.options.opacity,
                            fillColor: layer.options.fillColor,
                            fillOpacity: layer.options.fillOpacity,
                            dashArray: layer.options.dashArray,
                            ...layer.options
                        }).addTo(printMapInstance);
                        if (layer.getPopup()) {
                            newCircle.bindPopup(layer.getPopup().getContent());
                        }
                    } else if (layer instanceof L.CircleMarker && !(layer instanceof L.Circle)) {
                        // Handle circle markers with full styling
                        const newCircleMarker = L.circleMarker(layer.getLatLng(), {
                            radius: layer.options.radius,
                            color: layer.options.color,
                            weight: layer.options.weight,
                            opacity: layer.options.opacity,
                            fillColor: layer.options.fillColor,
                            fillOpacity: layer.options.fillOpacity,
                            ...layer.options
                        }).addTo(printMapInstance);
                        if (layer.getPopup()) {
                            newCircleMarker.bindPopup(layer.getPopup().getContent());
                        }
                    } else if (layer instanceof L.GeoJSON) {
                        // Handle GeoJSON layers with styling
                        const newGeoJSON = L.geoJSON(layer.toGeoJSON(), {
                            style: layer.options.style,
                            pointToLayer: layer.options.pointToLayer,
                            onEachFeature: layer.options.onEachFeature,
                            filter: layer.options.filter,
                            coordsToLatLng: layer.options.coordsToLatLng,
                            ...layer.options
                        }).addTo(printMapInstance);
                    } else if (layer instanceof L.LayerGroup) {
                        // Handle layer groups recursively
                        const newLayerGroup = L.layerGroup();
                        layer.eachLayer(function(subLayer) {
                            // Recursively add sublayers with styling
                            if (subLayer instanceof L.Marker) {
                                const newSubMarker = L.marker(subLayer.getLatLng(), {
                                    icon: subLayer.options.icon,
                                    opacity: subLayer.options.opacity,
                                    ...subLayer.options
                                });
                                if (subLayer.getPopup()) {
                                    newSubMarker.bindPopup(subLayer.getPopup().getContent());
                                }
                                newLayerGroup.addLayer(newSubMarker);
                            }
                            // Add other sublayer types as needed
                        });
                        newLayerGroup.addTo(printMapInstance);
                    } else if (layer instanceof L.ImageOverlay) {
                        // Handle image overlays
                        const newImageOverlay = L.imageOverlay(
                            layer._url,
                            layer.getBounds(),
                            {
                                opacity: layer.options.opacity,
                                alt: layer.options.alt,
                                interactive: layer.options.interactive,
                                crossOrigin: layer.options.crossOrigin,
                                errorOverlayUrl: layer.options.errorOverlayUrl,
                                zIndex: layer.options.zIndex,
                                className: layer.options.className,
                                ...layer.options
                            }
                        ).addTo(printMapInstance);
                    }
                    // Note: TileLayer is handled separately above
                });
                
                // Ensure the print map renders properly
                setTimeout(() => {
                    printMapInstance.invalidateSize();
                    
                    // Enable screenshot button once everything is loaded
                    setTimeout(() => {
                        const screenshotBtn = document.querySelector('.screenshot-btn');
                        if (screenshotBtn) {
                            screenshotBtn.disabled = false;
                            screenshotBtn.innerHTML = '<i class="fa-solid fa-print"></i> Print Map';

                        }
                    }, 1000);
                }, 200);
            }, 100);
        }
        
        // Close screenshot preview
        function closePrintPreview() {
            document.getElementById('printModal').style.display = 'none';
            if (printMapInstance) {
                printMapInstance.remove();
                printMapInstance = null;
            }
        }
        function captureMapScreenshot() {
            const captureButton = document.querySelector('.screenshot-btn');
            const originalText = captureButton.textContent;
            const title = document.querySelector('.print-header h2');
            const printActions = document.querySelector('.print-actions');
            const closeButton = document.querySelector('.close-btn');
            const originalTitle = title.textContent;
        
            // Update title and hide buttons
            title.textContent = 'FracTracker Data Portal';
            printActions.style.display = 'none';
            closeButton.style.display = 'none';
        
            // Show waiting cursor
            document.body.style.cursor = 'wait';
        
            setTimeout(() => {
                if (printMapInstance) {
                    printMapInstance.invalidateSize();
                }
        
                setTimeout(() => {
                    const printContent = document.querySelector('.print-content');
        
                    html2canvas(printContent, {
                        useCORS: true,
                        allowTaint: true,
                        scale: 2,
                        logging: false,
                        width: printContent.offsetWidth,
                        height: printContent.offsetHeight,
                        backgroundColor: '#ffffff',
                        foreignObjectRendering: false,
                        imageTimeout: 15000,
                        onclone: function(clonedDoc) {
                            const images = clonedDoc.querySelectorAll('img');
                            images.forEach(img => {
                                if (!img.complete) {
                                    img.onload = function() {};
                                }
                            });
                        }
                    }).then(function(canvas) {
                        // Ask user for filename
                        let userInput = prompt("Enter a filename for your download:", "fractracker-dataportal-map");
                        if (!userInput) {
                            userInput = "fractracker-dataportal-map";
                        }
        
                        // Sanitize filename (remove invalid characters)
                        userInput = userInput.replace(/[^a-z0-9_\-\.]/gi, '_').toLowerCase();
        
                        // Add date to filename
                        const filename = `${userInput}.png`;
        
                        const link = document.createElement('a');
                        link.download = filename;
                        link.href = canvas.toDataURL('image/png');
        
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
        
                        // Reset UI
                        title.textContent = originalTitle;
                        printActions.style.display = 'block';
                        closeButton.style.display = 'block';
                        document.body.style.cursor = 'default';
        
                        showMessage('Screenshot saved successfully!', 'success');
                        setTimeout(() => {
                            closePrintPreview();
                        }, 1000);
        
                    }).catch(function(error) {
                        console.error('Screenshot failed:', error);
        
                        // Reset UI
                        title.textContent = originalTitle;
                        printActions.style.display = 'block';
                        closeButton.style.display = 'block';
                        captureButton.disabled = false;
                        captureButton.textContent = originalText;
                        document.body.style.cursor = 'default';
        
                        showMessage('Screenshot failed. Please try again.', 'error');
                    });
                }, 1500);
            }, 500);
        }
        
        
        // Show temporary message
        function showMessage(text, type) {
            const message = document.createElement('div');
            message.textContent = text;
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 24px;
                border-radius: 4px;
                color: white;
                font-weight: bold;
                z-index: 10001;
                ${type === 'success' ? 'background-color: #4CAF50;' : 'background-color: #f44336;'}
            `;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                document.body.removeChild(message);
            }, 3000);
        }
        
        // Wait for tiles to load before enabling screenshot
        function waitForTilesToLoad() {
            const printButtons = document.querySelectorAll('.print-btn');
            
            // Disable buttons initially
            printButtons.forEach(btn => {
                btn.disabled = true;
                btn.textContent = btn.textContent.replace('üìã', '‚è≥');
            });
            
            // Re-enable after a short delay to allow tiles to load
            setTimeout(() => {
                printButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.textContent = btn.textContent.replace('‚è≥', 'üìã');
                });
            }, 2000);
        }



        // Function to toggle filter visibility
        function toggleFilter(filterName) {
            let list = ['counties','wellstatus','welltype','ftacat']


            list.forEach(element => {
                var filterContent = document.querySelector('.' + element + '-content');
                var filterBox = document.querySelector('.toggle-' + element);
                var filterIcon = document.querySelector('.filter.toggle-' + element + ' h4');
                var filterH4 = document.getElementById(element + 'h4')
                console.log('element')
                console.log(element)
                console.log(element !== "states")
                if (element === filterName ) {
                    if (filterContent.classList.contains('show')) {
                        filterContent.classList.remove('show');
                        filterContent.classList.add('hide');
                        filterBox.style.border = 'none';
                        filterH4.classList.remove('show');
                        filterH4.classList.add('hide');
                        filterIcon.style.setProperty('--after-content', '"‚åÑ"');
                    } else {
                    filterContent.classList.add('show');
                    filterContent.classList.remove('hide');
                    filterH4.classList.add('show');
                    filterH4.classList.remove('hide');
                    filterIcon.style.setProperty('--after-content', '"_"');
                    }
                } else {
                    filterContent.classList.remove('show');
                    filterContent.classList.add('hide');
                    filterH4.classList.remove('show');
                    filterH4.classList.add('hide');
                    filterIcon.style.setProperty('--after-content', '"‚åÑ"');
                }
            })


        }

        function openSplash() {
            document.getElementById("splashScreen").style.display = "block";
            showTab('tab1'); // Show default tab content
          }
        
        function closeSplash() {
            document.getElementById("splashScreen").style.display = "none";
          }
        function openDD() {
            document.getElementById("splashScreen").style.display = "block";
            showTab('tab3'); // Show default tab content
          }
        
        function closeDD() {
            document.getElementById("splashScreen").style.display = "none";
          }
          function showTab(tabId) {
            const content = {
              tab1: {
                title: 'Welcome to our National Oil & Gas Well Inventory Portal',
                text: `<br>This application was developed with the intention of providing a national database of oil and gas well infrastructure in a single location.<br>`+
                       `<br>¬© Copyright 2025 `+
                       `<a href="https://www.fractracker.org" target="_blank" rel="noopener noreferrer">FracTracker Alliance</a><br>`+
                       `<br>The FracTracker data available to the public on this web page is subject to the following terms and conditions:<br><br>`+
                       `<div style="font-size:13px;font-weight:normal;font-family:arial;margin-left:20px">1. The Site and App are provided on an ‚Äúas is‚Äù basis without warranties or representations of any kind, either express or implied, including, but not limited to, warranties of title or implied warranties of merchantability or fitness for a particular purpose. <br>2. In no event shall FracTracker be liable for any special, direct, indirect, consequential, or incidental damages or any damages whatsoever arising out of or in connection with the use of the Site and App or the contents of the Site and App.<br>3. FracTracker Alliance retains all rights, title, and interest in and to the Data compilation, the database structure, and the Portal itself, including all associated intellectual property rights. The license granted herein is strictly limited to the uses permitted under these Terms.<br>4. A core condition of using the Data is that your use must be consistent with and supportive of the mission of FracTracker Alliance. Our mission is to "map, analyze, and communicate the risks of oil, gas, and petrochemical development to advance just energy alternatives that protect public health, natural resources, and the climate." We reserve the right, <strong>in our sole discretion</strong>, to determine whether a particular use is consistent with our mission.<br>5. When using the Data in any public-facing materials, you must cite FracTracker Alliance as the source.<br>6. By using the Site and/or App, you agree to our <a href="https://www.fractracker.org/terms-of-service/" target="_blank" rel="noopener noreferrer">Terms of Service</a> (‚ÄúTerms‚Äù) and our <a href="https://www.fractracker.org/privacy-policy/" target="_blank" rel="noopener noreferrer">Privacy Policy</a> (‚ÄúPrivacy Policy‚Äù).</div>` +
                       `<button class="enter-button" id="enter-btn" style="margin-top:24px" onclick="closeSplash()">Enter</button>`+
                       `<br><label><input type="checkbox" class ="checkbox-agree" id="splash-checkbox"> <strong>I agree to the terms</strong></label>`
              },
              
              tab3: {
                title: 'About The Dataset',
                text:
                `<br><span><b>In need of background information? </b></span><a href="https://www.fractracker.org/resources/oil-and-gas-101/" target="_blank" rel="noopener noreferrer">Petrochemical Basics</a><br>`+
                `<br><span><b>Help Us Improve the FracTracker Data Portals:</b></span> <a href="https://forms.gle/NQ7QLRCm4HYm1SXF8" target="_blank" rel="noopener noreferrer">Feedback Form</a>`+
                '<br><br>This dataset is updated by FracTracker on a monthly basis and was last updated 08/01/25.'+
                '<br><br><b>Oil and Natural Gas</b>'+
                `<br><br><u>Oil</u> ‚Äì <i>Oil is a liquid fossil fuel that is found in underground reservoirs.  It is the result of organic materials that have been subjected to geologic heat and pressure over millions of years.</i>`+
                `<br><br><u>Gas</u> ‚Äì <i>Often called ‚Äúnatural gas,‚Äù gas refers to methane or a mixture that is dominated by methane.  It is in the gaseous phase at surface temperature and pressure, but can be converted to liquids at extremely low temperatures.  ‚ÄúFracked gas‚Äù and ‚Äúshale gas‚Äù both refer to gas that has been trapped in tight formations such as shale that typically requires industrial-scale hydraulic fracturing to release in economically viable quantities.</i>`+
                '<br><br><b>Well Category</b>'+
                `<br>Oil and gas wells are complicated, and there are a large number of ways to categorize them. For example, Texas has 85 categories that combine well various well functions and statuses.  Each state has the responsibility to construct datasets that reflect their own state laws, so the net effect is rather unwieldy when taken in aggregate. To that end, we have created six categories that help to quickly understand some basics about any given well. This includes:`+

                '<br><br>Our attempt to normalize the myriad of well types and statuses used by the individual state agencies'+
                `<br><br><u>Injection / Storage / Service</u> ‚Äì <i>These are oil and gas-related wells, but they are not intended to extract hydrocarbons. It includes injection wells like waste disposal and enhanced oil recovery wells, gas storage wells, and other service wells like monitoring wells for other activities.</i>`+
                `<br><br><u>Not Drilled</u> ‚Äì <i>This includes any well that has been proposed but not drilled.  It could newly permitted wells, wells that were applied for and rejected, and wells that were permitted but that the operator didn‚Äôt wind up drilling.</i>`+
                `<br><br><u>Orphaned / Abandoned / Unverified</u> ‚Äì <i>Abandoned wells are wells that are no longer in service and need to be plugged.  Orphaned wells are abandoned wells where there is no responsible party, so the responsibility of plugging falls to the state.  Unverified Plug wells are those where a well is known to have been drilled but the data does not contain a plug date or status consistent with having been plugged.</i>`+
                `<br><br><u>Other / Unknown</u> ‚Äì <i>These are wells in state inventories where the well type and status are not known based on available data. This category also includes water wells, which some states list alongside oil & gas wells.</i>`+
                `<br><br><u>Plugged</u> ‚Äì <i>These wells are listed as plugged, either through the well status, the presence of a plug date in the dataset, or both.</i>`+
                `<br><br><u>Production / Storage / Service</u> ‚Äì <i>Oil and gas wells that are meant for production of hydrocarbons, and where the status indicates that well is active.</i>`

            }
        };
      
        // Enable or disable the button based on checkbox state



        const tabContent = document.getElementById("tabContent");
        tabContent.innerHTML = `<h2>${content[tabId].title}</h2><p style="font-family:arial">${content[tabId].text}</p>`;
      



        // ‚úÖ Only attach checkbox logic if this is tab1
        if (tabId === 'tab1') {
            const checkbox = document.getElementById('splash-checkbox');
            const enterBtn = document.getElementById('enter-btn');
            {% comment %} const close_x = document.getElementById('closex'); {% endcomment %}
            const btn1 = document.getElementById('btn1');
            const btn2 = document.getElementById('btn2');
          
            // Restore checkbox state from sessionStorage
            const savedState = sessionStorage.getItem('splashCheckboxChecked');
            if (savedState === 'true') {
              checkbox.checked = true;
              enterBtn.classList.add('enabled');
              {% comment %} close_x.classList.add('enabled'); {% endcomment %}
              btn1.classList.add('active');
              btn2.classList.add('active');
            }
          
            checkbox.addEventListener('change', function () {
              sessionStorage.setItem('splashCheckboxChecked', checkbox.checked);
          
              if (checkbox.checked) {
                enterBtn.classList.add('enabled');
                {% comment %} close_x.classList.add('enabled'); {% endcomment %}
                btn1.disabled=false;
                btn2.disabled=false;

              } else {
                enterBtn.classList.remove('enabled');
                {% comment %} close_x.classList.remove('enabled'); {% endcomment %}
                btn1.disabled=true;
                btn2.disabled=true;
              }
            });
          }
      }
      document.addEventListener('DOMContentLoaded', () => {
        if (document.getElementById('splash-checkbox')) {
        const mcheckbox = document.getElementById('splash-checkbox');
    
        // Restore state on load (within session)
        if (sessionStorage.getItem('modalCheckboxChecked') === 'true') {
          mcheckbox.checked = true;
        }
    
        // Update state when checkbox is clicked
        mcheckbox.addEventListener('change', () => {
          sessionStorage.setItem('modalCheckboxChecked', mcheckbox.checked);
        });}
      });
      
      document.addEventListener('DOMContentLoaded', () => {
        const splashScreen = document.getElementById('splashScreen');
    
        splashScreen.addEventListener('click', function (e) {
          // Only block if click is directly on the background overlay
          if (e.target === splashScreen) {
            console.log('Overlay clicked - do nothing');
            // Prevent accidental modal close
            e.stopPropagation();
          } else {
            console.log('Clicked inside modal content');
          }
        });
      });


        // ‚úÖ Show modal on load
        window.addEventListener('DOMContentLoaded', () => {
            const splash = document.getElementById("splashScreen");
            splash.style.display = "block"; // show modal

            // Load tab1 content
            showTab('tab1');
        });

        // ‚úÖ Close modal if clicked outside
        window.onclick = function (event) {
            const splash = document.getElementById("splashScreen");
            if (event.target === splash) {
            splash.style.display = "none";
            }
        };
        window.addEventListener('beforeunload', function () {
            sessionStorage.clear();
          });

        document.addEventListener('DOMContentLoaded', () => {
        const isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                        || window.innerWidth <= 768;
        
        if (isMobile) {
            console.log("Mobile device detected, for a more user friendly experience rotate your device so that it's horizontal");
        } else (
            console.log("Likely a desktop")
        )
        });

        window.addEventListener("beforeprint", () => {
            if (map && map.invalidateSize) {
              setTimeout(() => {
                map.invalidateSize();
              }, 100);
            }
          });
        // Close modal when clicking outside
        window.onclick = function(event) {
            const pmodal = document.getElementById('printModal');
            if (event.target === pmodal) {
                closePrintPreview();
            }
        };


{% comment %} 
        function openModal() {
            document.getElementById('csvModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('csvModal').style.display = 'none';
            document.getElementById('csvForm').reset();
            document.getElementById('csvMsg').innerText = '';
        }
        
        document.getElementById('downloadBtn').addEventListener('click', openModal);
        
        document.getElementById('csvForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            
            fetch('/request-csv/', {
                method: 'POST',
                body: formData
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'success') {
                    document.getElementById('csvMsg').innerText = 'üìß CSV sent to your email.';
                } else {
                    document.getElementById('csvMsg').innerText = '‚ùå ' + data.message;
                }
            })
            .catch(() => {
                document.getElementById('csvMsg').innerText = '‚ö†Ô∏è Error sending request.';
            });
        }); {% endcomment %}



        document.addEventListener('DOMContentLoaded', function () {
            const downloadBtn = document.getElementById('downloadBtn');
            const downloadForm = document.getElementById('downloadForm');
            const errorMessage = document.getElementById('errorMessage');
            const dmodal = document.getElementById('downloadModal');
        
            // Close the modal
            function closeModalHandler() {
                const bootstrapModal = bootstrap.Modal.getInstance(dmodal) || new bootstrap.Modal(dmodal);
                bootstrapModal.hide();
                downloadForm.reset();
                clearErrors();
            }
        
            // Modal event listeners
            dmodal.querySelector('.modal-dialog').addEventListener('click', (e) => e.stopPropagation()); // Prevent closing when clicking inside the modal
        
            downloadBtn.addEventListener('click', async function () {
                // Clear previous errors
                clearErrors();
        
                // Get form data
                const formData = new FormData(downloadForm);
                const name = formData.get('name')?.trim() || '';
                const email = formData.get('email')?.trim() || '';
                const affiliation = formData.get('affiliation')?.trim() || '';
                const state = formData.get('state')?.trim() || '';
                
                console.log(affiliation)
                console.log(state)
        
                // Basic validation - check all required fields
                if (!name || !email || !affiliation || !state) {
                    showError('Please fill in all required fields.');
                    return;
                }
        
                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showError('Please enter a valid email address.');
                    showFieldError('userEmail', 'Please enter a valid email address.');
                    return;
                }
        
                // Show loading state
                setLoadingState(true);
        
                try {
                    // Get CSRF token
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
                    // Send AJAX request
                    const response = await fetch('{% url "wells:download_csv" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken,
                        },
                        body: JSON.stringify({
                            name: name,
                            email: email,
                            affiliation: affiliation,
                            state: state,
                        })
                    });
                    
                    console.log(`response status: ${response.status}`);
                    
                    if (response.ok) {
                        // Parse JSON response (since your Django view now returns JSON)
                        const data = await response.json();
                        
                        if (data.success) {
                            // Handle successful form submission
                            console.log('Form successfully submitted and saved to database');
                            console.log('Download ID:', data.download_id);
                            
                            // Show success message
                            {% comment %} showSuccess(data.message || 'Form submitted successfully!'); {% endcomment %}
                            showSuccess(data.message || '');

                            
                            // Check if feedback form should be opened
                            const fbcheckbox = document.getElementById('fCheckbox');
                            if (fbcheckbox && fbcheckbox.checked) {
                                window.open('https://forms.gle/NQ7QLRCm4HYm1SXF8', '_blank');
                                console.log('Opening feedback form');
                            }
                            
                            // Download the CSV using client-side data
                            if (typeof filteredData !== 'undefined' && filteredData) {
                                downloadTableData(filteredData);
                            }
                            
                            // Close modal and reset form after a short delay
                            setTimeout(() => {
                                closeModalHandler();
                            }, 1500);
                            
                        } else {
                            // Handle error from server
                            if (data.error && typeof data.error === 'object') {
                                // Handle field-specific errors from Django form validation
                                let errorMessages = [];
                                for (const [field, messages] of Object.entries(data.error)) {
                                    const fieldName = field.charAt(0).toUpperCase() + field.slice(1);
                                    errorMessages.push(`${fieldName}: ${Array.isArray(messages) ? messages.join(', ') : messages}`);
                                }
                                showError(errorMessages.join('<br>'));
                            } else {
                                showError(data.error || 'An error occurred while processing your request.');
                            }
                        }
                    } else {
                        // Handle HTTP error responses
                        try {
                            const errorData = await response.json();
                            showError(errorData.error || `Server error (${response.status}). Please try again later.`);
                        } catch (e) {
                            showError(`Server error (${response.status}). Please try again later.`);
                        }
                    }
                } catch (error) {
                    console.error('Submit error:', error);
                    showError('An error occurred. Please check your connection and try again.');
                } finally {
                    setLoadingState(false);
                    console.log('Submit process completed');
                }
            });
        
            function setLoadingState(loading) {
                if (loading) {
                    downloadBtn.disabled = true;
                    downloadBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...';
                } else {
                    downloadBtn.disabled = false;
                    downloadBtn.innerHTML = 'Download CSV';
                }
            }
        
            function showError(message) {
                errorMessage.innerHTML = message;
                errorMessage.classList.remove('d-none');
            }
        
            function showSuccess(message) {
                // Clear any existing errors first
                clearErrors();
                
                // Show success message in the error message div (reusing the same element)
                errorMessage.innerHTML = message;
                errorMessage.classList.remove('d-none');
                errorMessage.classList.remove('alert-danger');
                errorMessage.classList.add('alert-success');
                
                // Reset to error styling after a delay
                setTimeout(() => {
                    errorMessage.classList.remove('alert-success');
                    errorMessage.classList.add('alert-danger');
                }, 3000);
            }
        
            function showFieldError(fieldId, message) {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.classList.add('is-invalid');
                    // Create or update invalid feedback element
                    let feedback = field.parentNode.querySelector('.invalid-feedback');
                    if (!feedback) {
                        feedback = document.createElement('div');
                        feedback.className = 'invalid-feedback';
                        field.parentNode.appendChild(feedback);
                    }
                    feedback.textContent = message;
                }
            }
        
            function clearErrors() {
                errorMessage.classList.add('d-none');
                errorMessage.innerHTML = '';
                const invalidFields = document.querySelectorAll('.is-invalid');
                invalidFields.forEach(field => {
                    field.classList.remove('is-invalid');
                });
                const feedbackElements = document.querySelectorAll('.invalid-feedback');
                feedbackElements.forEach(element => {
                    element.textContent = '';
                });
            }
        });
        

    </script>
</body>
</html>
